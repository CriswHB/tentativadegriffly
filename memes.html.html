<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Griffy - Mural de Memes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <style>
    :root {
      --color-primary-purple: #5E35B1;
      --color-dark-bg: #1f0b38;
      --color-glow-light: #9C27B0;
      --color-accent-pink: #d15ac7;
    }

    .login-body {
      background-color: var(--color-dark-bg);
      background-image:
        radial-gradient(circle at 50% 15%, rgba(130, 80, 250, 0.45) 0%, transparent 40%),
        radial-gradient(circle at 80% 85%, rgba(0, 200, 255, 0.15) 0%, transparent 50%);
      background-size: cover;
      background-attachment: fixed;
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
      position: relative;
    }

    .login-overlay-hidden {
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
    }

    @keyframes star-move {
        from { transform: translateY(0); }
        to { transform: translateY(-2000px); }
    }

    .login-body::after {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 100%; height: 2000px;
        background: transparent;
        box-shadow: 10px 50px #FFF, 150px 1200px #FFF, 400px 500px #FFF, 800px 1800px #FFF, 1200px 700px #FFF;
        opacity: 0.3;
        animation: star-move 100s linear infinite;
        z-index: 1;
    }

    .griffy-title {
      font-family: 'Rajdhani', sans-serif;
      color: var(--color-primary-purple);
      letter-spacing: 5px;
      text-shadow: 0 4px 10px rgba(94, 53, 177, 0.5);
    }
   
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .animate-float { animation: float 4s ease-in-out infinite; }
   
    .tab-active { border-color: var(--color-primary-purple) !important; color: var(--color-primary-purple) !important; }
    
    .btn-solid-purple {
      background-color: var(--color-primary-purple);
      box-shadow: 0 4px 15px rgba(94, 53, 177, 0.4);
    }

    .mural-container {
        padding: 24px;
        z-index: 5;
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 16px;
        margin: 30px auto;
        backdrop-filter: blur(10px);
    }

    .add-meme-button {
        background-color: var(--color-accent-pink);
        transition: all 0.3s;
    }

    .meme-card {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid rgba(156, 39, 176, 0.2);
        transition: all 0.3s;
    }
    .meme-card:hover { transform: translateY(-5px); border-color: var(--color-accent-pink); }

    .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background-color: #1f0b38;
        padding: 32px;
        border-radius: 16px;
        width: 90%;
        max-width: 500px;
        border: 2px solid var(--color-primary-purple);
    }
  </style>
</head>
<body class="text-gray-200 antialiased login-body">

  <div id="loginOverlay" class="fixed inset-0 flex items-center justify-center z-50 p-4 transition-opacity duration-500">
    <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md text-gray-800">
      <div class="flex justify-center mb-6">
        <img src="https://i.imgur.com/PNHIDfo.png" alt="Grifo" class="w-24 h-24 animate-float" />
      </div>
      <h2 class="griffy-title text-5xl font-bold mb-8 text-center uppercase">Griffy</h2>
      <div class="flex justify-center space-x-4 mb-6">
        <button id="showLoginBtn" class="px-4 py-2 text-lg tab-active border-b-2">Entrar</button>
        <button id="showRegisterBtn" class="px-4 py-2 text-lg text-gray-500 border-b-2 border-transparent">Criar conta</button>
      </div>
     
      <form id="loginForm" class="space-y-4">
        <input type="text" id="usernameInput" required class="w-full px-4 py-3 border rounded-xl" placeholder="Usuário Habbo">
        <input type="password" required class="w-full px-4 py-3 border rounded-xl" placeholder="Senha">
        <button type="submit" class="w-full btn-solid-purple text-white py-3 rounded-xl font-bold uppercase">Entrar</button>
      </form>
      <div id="message-box" class="mt-4 text-center text-sm hidden"></div>
    </div>
  </div>

  <main id="mainAppContent" class="hidden max-w-7xl mx-auto px-4">
    <div id="memesSection" class="mural-container">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-bold flex items-center gap-3">
                <img src="https://i.imgur.com/uuo3g6l.png" class="w-10 h-10" /> Mural de Memes
            </h2>
            <button id="showAddMemeModalBtn" class="add-meme-button px-6 py-2 rounded-lg font-bold flex items-center gap-2">
                <span class="material-symbols-outlined">add_circle</span> Adicionar Meme
            </button>
        </div>

        <div id="memeGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
    </div>
  </main>

  <div id="addMemeModal" class="modal-overlay hidden">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-6 text-center text-white">Novo Meme</h3>
        <form id="addMemeForm" class="space-y-4">
            <input type="url" id="memeUrl" required class="w-full p-3 bg-black/30 border border-purple-500 rounded-lg text-white placeholder-gray-400" placeholder="URL da Imagem">
            <input type="text" id="memeTitle" required maxlength="80" class="w-full p-3 bg-black/30 border border-purple-500 rounded-lg text-white placeholder-gray-400" placeholder="Legenda do Meme">
            <div class="flex justify-end gap-3">
                <button type="button" onclick="document.getElementById('addMemeModal').classList.add('hidden')" class="px-4 py-2 text-gray-400">Cancelar</button>
                <button type="submit" id="submitBtn" class="add-meme-button px-6 py-2 rounded-lg font-bold text-white">Publicar</button>
            </div>
        </form>
    </div>
  </div>

  <script type="module">
    // Importações do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { 
        getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, updateDoc, doc, increment 
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- COLOQUE SEUS DADOS DO FIREBASE AQUI ---
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "SEU_ID",
      appId: "SEU_APP_ID"
    };

    // Inicialização
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const loginForm = document.getElementById('loginForm');
    const loginOverlay = document.getElementById('loginOverlay');
    const mainAppContent = document.getElementById('mainAppContent');
    const memeGrid = document.getElementById('memeGrid');
    const addMemeForm = document.getElementById('addMemeForm');

    // Login Simples
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            await signInAnonymously(auth);
            loginOverlay.style.opacity = '0';
            setTimeout(() => {
                loginOverlay.classList.add('hidden');
                mainAppContent.classList.remove('hidden');
            }, 500);
        } catch (err) {
            console.error("Erro ao entrar:", err);
        }
    });

    // Abrir Modal
    document.getElementById('showAddMemeModalBtn').onclick = () => {
        document.getElementById('addMemeModal').classList.remove('hidden');
    };

    // Função para renderizar card (agora com ID do Firebase)
    function renderMemeCard(id, data) {
        const date = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString() : 'Agora';
        const div = document.createElement('div');
        div.className = 'meme-card';
        div.innerHTML = `
            <div class="h-48 overflow-hidden">
                <img src="${data.url}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/400x200?text=Erro+na+Imagem'">
            </div>
            <div class="p-4 bg-[#1a0930]">
                <h3 class="font-bold text-lg text-white">${data.title}</h3>
                <p class="text-xs text-gray-400 mb-3">por @${data.author}</p>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-500">${date}</span>
                    <button onclick="window.likeMeme('${id}')" class="flex items-center gap-1 text-pink-400 hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-sm">thumb_up</span>
                        <span>${data.likes || 0}</span>
                    </button>
                </div>
            </div>
        `;
        return div;
    }

    // Carregar memes em tempo real
    const q = query(collection(db, "memes"), orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
        memeGrid.innerHTML = '';
        snapshot.forEach((doc) => {
            memeGrid.appendChild(renderMemeCard(doc.id, doc.data()));
        });
    });

    // Publicar no Firebase
    addMemeForm.onsubmit = async (e) => {
        e.preventDefault();
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerText = "Enviando...";

        try {
            await addDoc(collection(db, "memes"), {
                url: document.getElementById('memeUrl').value,
                title: document.getElementById('memeTitle').value,
                author: document.getElementById('usernameInput').value || "Membro",
                likes: 0,
                createdAt: serverTimestamp()
            });
            document.getElementById('addMemeModal').classList.add('hidden');
            addMemeForm.reset();
        } catch (err) {
            alert("Erro ao publicar!");
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerText = "Publicar";
        }
    };

    // Função global de Like
    window.likeMeme = async (id) => {
        const docRef = doc(db, "memes", id);
        await updateDoc(docRef, {
            likes: increment(1)
        });
    };
  </script>
</body>
</html>

